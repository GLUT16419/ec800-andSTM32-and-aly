# 冷链车监控系统（EC800 + STM32 + 阿里云）

## 项目简介

本项目实现了一个基于 STM32 微控制器和 EC800 通信模块的冷链车监控系统，主要功能包括：

- **温湿度监测**：使用 SHT41 传感器实时监测冷链车内的温度和湿度
- **GNSS 定位**：通过 EC800 模块的 GNSS 功能获取车辆位置和速度
- **数据上传**：将监测数据上传到阿里云物联网平台
- **短信报警**：当温湿度超过阈值时，发送短信报警
- **数据滤波**：使用中值滤波和滑动平均滤波算法提高数据准确性
- **温度补偿**：对湿度测量值进行温度补偿，提高测量精度

## 硬件组成

- **STM32F103C8T6**：主控制器
- **EC800M-CN**：4G 通信模块，支持 GNSS 定位
- **SHT41**：高精度温湿度传感器
- **其他**：电源模块、连接线等

## 软件架构

### 核心文件

- **Core/Src/main.c**：主程序逻辑，包含传感器数据采集、滤波、报警等功能
- **Core/Src/usart.c**：串口通信，包含与 EC800 模块的通信和阿里云数据上传功能
- **Core/Inc/**：头文件目录

### 主要功能模块

1. **传感器数据采集**：通过 I2C 接口读取 SHT41 温湿度传感器数据
2. **数据滤波**：使用组合滤波算法（中值滤波 + 滑动平均滤波）处理传感器数据
3. **GNSS 定位**：通过 AT 指令获取 EC800 模块的 GNSS 定位数据
4. **阿里云上传**：将处理后的数据通过 MQTT 协议上传到阿里云物联网平台
5. **短信报警**：当温湿度超过设定阈值时，发送短信报警

## 阿里云配置

### 设备信息

- **服务器地址**：iot-example.mqtt.iothub.aliyuncs.com
- **设备名称**：example-device
- **设备密钥**：example-key-1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

### 上报数据格式

```json
{
  "id": "100",
  "version": "1.0",
  "params": {
    "mhumi": 50.5,
    "VehInsideTemp": 10.2,
    "GeoLocation": {
      "Longitude": 116.397428,
      "Latitude": 39.90923,
      "Altitude": 50.5,
      "CoordinateSystem": 1
    },
    "VehSpeed": 45.5
  },
  "method": "thing.event.property.post"
}
```

## 短信报警配置

- **报警阈值**：
  - 温度上限：25.0°C
  - 温度下限：2.0°C
  - 湿度上限：80.0%RH
  - 氧气含量下限：19.5%
- **接收号码**：13800000000
- **报警间隔**：1小时

## 编译与烧录

### 开发环境

- **IDE**：STM32CubeIDE
- **HAL 库**：STM32F1xx HAL Driver
- **编译工具链**：ARM GCC

### 烧录方式

- 使用 ST-Link 调试器烧录
- 使用串口 ISP 烧录

## 注意事项

1. **敏感信息**：本项目中的阿里云连接信息和短信接收号码均为示例数据，实际使用时需要修改为真实信息
2. **硬件连接**：确保 STM32 与 EC800 模块的串口连接正确
3. **电源供应**：确保系统有稳定的电源供应
4. **天线安装**：EC800 模块需要安装合适的天线以获得良好的信号

## 项目结构

```
.
├── Core/
│   ├── Inc/          # 头文件
│   └── Src/          # 源文件
├── Drivers/          # 驱动文件
├── README.md         # 项目说明
├── .gitignore        # Git 忽略文件
└── CMakeLists.txt    # CMake 配置文件
```

## 参考文档

- STM32F103C8T6 参考手册
- EC800M-CN 模块 AT 指令手册
- SHT41 传感器数据手册
- 阿里云物联网平台文档

## 许可证

本项目仅供学习参考，请勿用于商业用途。