# STM32冷链监控系统

## 项目介绍

基于STM32的冷链监控系统，包含以下功能：

- 温湿度数据采集（使用SHT41传感器）
- GNSS定位和车速监测
- 阿里云物联网平台数据上传
- 温度、湿度、氧气含量阈值报警（短信通知）
- 数据滤波和异常处理

## 硬件组成

- STM32F103C8T6主控芯片
- SHT41温湿度传感器（I2C接口）
- EC800M 4G模块（串口通信）
- GNSS模块（集成在EC800M中）

## 软件架构

- 使用STM32 HAL库进行硬件驱动
- 实现了完整的数据采集、处理和上传流程
- 包含多种滤波算法，提高数据准确性
- 支持短信报警功能，当数据超过阈值时发送通知

## 项目结构

- `Core/Src/` - 源代码文件
- `Core/Inc/` - 头文件
- `Drivers/` - STM32标准驱动库
- `CMakeLists.txt` - CMake构建配置

## 配置说明

### 敏感信息配置

- `main.c` 中的 `SMS_RECIPIENT_NUMBER` 宏定义：短信接收号码
- `usart.c` 中的阿里云连接信息：服务器地址、设备ID、密钥等

**注意**：上传到GitHub的代码中，敏感信息已被替换为假数据，实际使用时需要根据实际情况修改。

## 编译与烧录

### 使用CMake编译

```bash
mkdir build
cd build
cmake ..
cmake --build .
```

### 使用MDK-ARM编译

- 打开 `MDK-ARM/dgb.uvprojx` 项目文件
- 编译生成hex文件
- 使用ST-Link或其他烧录工具烧录到STM32芯片

## 阿里云平台配置

1. 在阿里云物联网平台创建产品和设备
2. 获取设备的ProductKey、DeviceName和DeviceSecret
3. 修改 `usart.c` 中的连接信息
4. 在阿里云平台查看和管理设备数据

## 短信报警配置

1. 确保EC800M模块已正确插入SIM卡
2. 修改 `main.c` 中的 `SMS_RECIPIENT_NUMBER` 为实际接收号码
3. 根据需要调整报警阈值

## 数据上传频率

- 温湿度数据：每15秒上传一次
- GNSS定位数据：首次定位延迟5分钟，后续每2分钟上传一次

## 故障排除

### 常见问题

1. **无法连接阿里云**
   - 检查EC800M模块是否正常工作
   - 检查SIM卡是否有信号
   - 检查连接信息是否正确

2. **温湿度数据异常**
   - 检查SHT41传感器连接是否正常
   - 检查I2C总线是否有干扰

3. **GNSS定位失败**
   - 确保设备在开阔环境中
   - 首次定位可能需要较长时间（5-10分钟）

## 许可证

本项目基于STM32 HAL库，遵循STMicroelectronics的许可证条款。

## 联系方式

如有问题，欢迎交流讨论。
